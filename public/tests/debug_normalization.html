<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Chord Normalization</title>
    <link rel="stylesheet" href="css/test-suite.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Test Suite</a>
        <div class="header">
            <h1>Debug Chord Normalization</h1>
            <p>A simple interface to test the `normalizeChord` function live.</p>
        </div>

        <div class="content-box">
            <div class="summary" style="display: none;">
                <div id="summary-content"></div>
            </div>

            <div class="controls">
                 <button class="btn" onclick="rerunTests()">Rerun Tests</button>
                 <button class="btn" onclick="exportJSON()">Export Results (JSON)</button>
                 <div id="copy-status" class="status-area"></div>
            </div>

            <div id="debug" class="test-output"></div>
        </div>
    </div>

    <script src="../js/utils/normalization.js"></script>
    <script>
        const debugDiv = document.getElementById('debug');
        let testResults = [];
        let passedCount = 0;
        let failedCount = 0;

        function updateCounts() {
            const summaryDiv = document.querySelector('.summary');
            const summaryContent = document.getElementById('summary-content');
            const successRate = testResults.length > 0 ? Math.round((passedCount / testResults.length) * 100) : 0;

            summaryContent.innerHTML = `
                <p><strong>Total Tests:</strong> ${testResults.length}</p>
                <p><strong>Passed:</strong> ${passedCount} ‚úÖ</p>
                <p><strong>Failed:</strong> ${failedCount} ‚ùå</p>
                <p><strong>Success Rate:</strong> ${successRate}%</p>
            `;
            summaryDiv.style.display = 'block';
        }

        function debugNormalizeChord(input, expected) {
            const div = document.createElement('div');
            
            const finalResult = normalizeChord(input);
            const isCorrect = finalResult === expected;

            // Store result
            testResults.push({
                input: input,
                output: finalResult,
                expected: expected,
                passed: isCorrect
            });

            if (isCorrect) {
                passedCount++;
            } else {
                failedCount++;
            }

            div.className = 'debug-item' + (isCorrect ? ' correct' : ' incorrect');

            div.innerHTML += `<div class="result"><strong>Input:</strong> "${input}"</div>`;
            div.innerHTML += `<div class="result"><strong>Output:</strong> "${finalResult}"</div>`;
            if (!isCorrect) {
                div.innerHTML += `<div class="result"><strong>Expected:</strong> "${expected}"</div>`;
            }
            
            return div;
        }

        function runTests(category, testCases) {
            const categoryHeader = document.createElement('h2');
            categoryHeader.textContent = category;
            debugDiv.appendChild(categoryHeader);

            testCases.forEach(testCase => {
                debugDiv.appendChild(debugNormalizeChord(testCase.input, testCase.expected));
            });
        }

        function rerunTests() {
            // Clear previous results
            debugDiv.innerHTML = '';
            testResults = [];
            passedCount = 0;
            failedCount = 0;
            document.getElementById('copy-status').textContent = '';

            // Rerun all tests
            runAllTestCategories();
            updateCounts();
        }

        function runAllTestCategories() {
            runTests("Basic Major & Minor", [
                { input: "CM7", expected: "Cmaj7" },
                { input: "C major 7", expected: "Cmaj7" },
                { input: "Cmaj7", expected: "Cmaj7" },
                { input: "CŒî7", expected: "Cmaj7" },
                { input: "C", expected: "C" },
                { input: "Cmajor", expected: "C" },
                { input: "C M", expected: "C" },
                { input: "Cmin7", expected: "Cm7" },
                { input: "C-7", expected: "Cm7" },
                { input: "c minor 7", expected: "Cm7" },
                { input: "Cm", expected: "Cm" },
                { input: "C-", expected: "Cm" }
            ]);

            runTests("Dominant Chords", [
                { input: "C7", expected: "C7" },
                { input: "C dominant 7", expected: "C7" },
                { input: "Cdom7", expected: "C7" }
            ]);

            runTests("Diminished & Half-Diminished", [
                { input: "Cdim", expected: "CÀö" },
                { input: "C¬∞", expected: "CÀö" },
                { input: "C diminished", expected: "CÀö" },
                { input: "C half dim", expected: "Cm7‚ô≠5" },
                { input: "C halfdim", expected: "Cm7‚ô≠5" },
                { input: "C√∏", expected: "Cm7‚ô≠5" },
                { input: "Cm7b5", expected: "Cm7‚ô≠5" }
            ]);

            runTests("Root Note Variations", [
                { input: "f#m7", expected: "F‚ôØm7" },
                { input: "Gbmaj7", expected: "G‚ô≠maj7" },
                { input: "A#-", expected: "A‚ôØm" },
                { input: "ebb7", expected: "EùÑ´7" },
                { input: "CXM7", expected: "CùÑ™maj7" }
            ]);
            
            runTests("Whitespace & Edge Cases", [
                { input: "  C M7  ", expected: "Cmaj7" },
                { input: "  db  -7 ", expected: "D‚ô≠m7" },
                { input: "", expected: "" },
                { input: "Hdim", expected: "Hdim" }, // Invalid note
                { input: "C#", expected: "C‚ôØ" },
                { input: "Fbb", expected: "FùÑ´" },
                { input: "G", expected: "G" }
            ]);
        }

        function exportJSON() {
            const exportData = {
                summary: {
                    total: testResults.length,
                    passed: passedCount,
                    failed: failedCount
                },
                results: testResults
            };
            const jsonText = JSON.stringify(exportData, null, 2);
            const copyStatus = document.getElementById('copy-status');
            navigator.clipboard.writeText(jsonText).then(() => {
                copyStatus.textContent = '‚úÖ JSON results copied to clipboard!';
            }).catch(err => {
                console.error('Failed to copy JSON:', err);
                copyStatus.textContent = '‚ùå Failed to copy. See console for details.';
            });
        }

        // Initial run on page load
        // document.addEventListener('DOMContentLoaded', rerunTests);
    </script>
</body>
</html> 